<!DOCTYPE HTML>
<html>
  <head>
    <style type="text/css">
    	canvas {
    		border: solid 1px black;
    		float: left;
    	}
    	
    	#objectList {
    		position: absolute;
    		right : 0px;
    		top: 0px;
    		border: solid 1px black;
    	}
    	
    	.object {
    		border: solid 1px black;
    	}
    </style>
    <script type="text/javascript" src="images.js"></script>
    <script type="text/javascript" src="map.js"></script>
    <script>
    	const IMAGE_FOLDER = '../images/';
    	const SQUARE_WIDTH = 58;
    	const SQUARE_HEIGHT = 30;
    	const MAP_SIZE = MAP.length;
    
		window.onload = function() {
			/*
			 * On commence par prÃ©charger les images avant toute chose 
			 */
			preloadImages(IMAGE_FOLDER, main);
		};

		function preloadImages(folder, callback) {
			var loadedImages = 0;
			var imageCount = 0;
			for(var i in TERRAINS) {
				imageCount++;
				var image = TERRAINS[i];
				object = new Image();
				object.onload = function() {
					if(++loadedImages >= imageCount) {
						callback();
					}
				}
				object.src = folder + image.src;
				image.object = object;
			}
		}
		
		function main() {
			/*
			 * On repli la liste de droite avec les images (terrains, batiments) dispos.
			 */
			fillObjectList();
			
			/*
			 * On dessine le terrain
			 */
			paint();
		}
		
		function paint() {
			var canvas = document.getElementById("canvas");
			var context = canvas.getContext("2d");
			paintLand(context);
			paintGrid(context);
		}
		
		function paintLand(context) {
			for (var y = 0 ; y < MAP_SIZE ; y++) {
				for (var x = 0 ; x < MAP_SIZE ; x++) {
					var posx = (SQUARE_WIDTH*MAP_SIZE)*0.5 + SQUARE_WIDTH*0.5*(x-1) - SQUARE_WIDTH*0.5*y;
					var posy = SQUARE_HEIGHT*0.5*y + SQUARE_HEIGHT*0.5*x + 30;
					var image = MAP[y][x];
					afficherImage(context, image, posx, posy);
				}
			}
		}	

		function paintGrid(context) {
			for(var i = 0 ; i < MAP_SIZE ; i++) {
				
			}	
		}
	
		function afficherImage(context, image, x, y) {
			if(!!image) {
				y = y - image.object.height;
				x = x + (58-image.object.width)/2;
				context.drawImage(image.object, x, y);
			}
		}

		function fillObjectList() {
			var table = document.getElementById("objectList");
			for(var i in TERRAINS) {
				var tr = document.createElement('tr');
				table.appendChild(tr);
				var td = document.createElement('td');
				td.className = 'object';
				tr.appendChild(td);
				var image = document.createElement('img');
				image.src = IMAGE_FOLDER + TERRAINS[i].src;
				td.appendChild(image);
			}
		}
		
    </script>
  </head>
  <body>
    <canvas id="canvas" width="986" height="768"></canvas>
    <table id="objectList"></table>
  </body>
</html>
