<!--
TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO

 - Il serait bon d'utiliser un objet anonyme pour les coordonnées, du style 
  {
   x: 256,
   y: 154 
  }
 - Parallèlement, il serait intéressant d'utiliser également un objet anonyme pour les positions dans la board
  {
   i: 1,
   j: 5
  }
  Le nom des variables serait VOLONTAIREMENT différent afin d'éviter les erreurs. 

TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO TODO
-->

<!DOCTYPE HTML>
<html>
<head>
<style type="text/css">
canvas {
	border: solid 1px black;
	float: left;
}

#objectList {
	border: solid 1px black;
	float: left;
}

.object {
	border: solid 1px black;
}
</style>
<script type="text/javascript" src="../lib/sylvester.src.js"></script>
<script type="text/javascript" src="tiles.js"></script>
<script type="text/javascript" src="../maps/map_test.js"></script>
<script type="text/javascript" src="map.js"></script>
<script>
	const
	IMAGE_FOLDER = '../images/';
	
	const
	REPAINT_DELAI = 50;

	/*
	 * xxx_WIDTH, xxx_HEIGHT => nombre de pixels
	 */
	const
	SQUARE_WIDTH = 58;
	const
	SQUARE_HEIGHT = 30;

	/*
	 * xxx_SIZE => nombre de cases
	 */
	const
	MAP_SIZE = MAP.length;

	var map = undefined;

	window.onload = function() {
		/*
		 * On commence par précharger les images 
		 */
		preloadImages(IMAGE_FOLDER, main);
		
		/*
		 * On instancie les objets
		 */
		//loadingMap();
	};

	function preloadImages(folder, callback) {
		var loadedImages = 0;
		var imageCount = 0;
		var toPreload = [ TERRAINS, BUILDINGS ];
		for(var p in toPreload)
		for ( var i in toPreload[p]) {
			imageCount++;
			var image = toPreload[p][i];
			var object = new Image();
			object.onload = function() {
				if (++loadedImages >= imageCount) {
					callback();
				}
			}
			object.src = folder + image.src;
			image.object = object;
		}
	}

	function main() {
		/*
		 * On rempli la liste de droite avec les images (terrains, batiments) dispos.
		 */
		fillObjectList();

		var canvas = document.getElementById("canvas");
		map = new Map(canvas, MAP_SIZE, MAP_SIZE, MAP);
		/*
		 * On dessine
		 */
		map.paint();
	}

	function paint() {
	}
	
	function get(c) {
		return MMAP[c.i][c.j];
	}
	
	function set(c, v) {
		MMAP[c.i][c.j] = v;
	}
	
	function isBuildable(c) {
		var object = get(c);
		if(!!object.buildable && false == object.buildable) {
			return false;
		}
		return true;
	}
	
	function isDestructible(c) {
		var object = MMAP[c.i][c.j];
		if(!!object.destructible && true == object.destructible) {
			return true;
		}
		return false;
	}
	
	function destroy(c) {
		if(isDestructible(c)) {
			set(c, undefined);
		}		
	}

	function fillObjectList() {
		var table = document.getElementById("objectList");
		for ( var i in TERRAINS) {
			var tr = document.createElement('tr');
			table.appendChild(tr);
			var td = document.createElement('td');
			td.className = 'object';
			tr.appendChild(td);
			var image = document.createElement('img');
			image.id = i;
			image.src = IMAGE_FOLDER + TERRAINS[i].src;
			image.onclick = function(e) {
				console.log(e.target.id);
				selectedTile = TERRAINS[e.target.id];
			}
			td.appendChild(image);
		}
		for ( var i in BUILDINGS) {
			var tr = document.createElement('tr');
			table.appendChild(tr);
			var td = document.createElement('td');
			td.className = 'object';
			tr.appendChild(td);
			var image = document.createElement('img');
			image.src = IMAGE_FOLDER + BUILDINGS[i].src;
			td.appendChild(image);
		}
	}
</script>
</head>
<body>
	<canvas id="canvas" width="986" height="768"></canvas>
	<table id="objectList"></table>
</body>
</html>
